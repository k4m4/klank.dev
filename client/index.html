<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>klank.dev</title>
    <style type="text/css" media="screen">
      #editor {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        height: 80%;
      }
      #console {
        position: absolute;
        right: 0;
        bottom: 0;
        left: 0;
        height: 20%
      }
    </style>
  </head>
  <body>
    <div id="editor">module Klank.Dev where

import Prelude
import Data.List ((:), List(..))
import Data.NonEmpty ((:|))
import Data.Typelevel.Num (D1)
import Effect (Effect)
import FRP.Behavior (Behavior)
import FRP.Behavior.Audio (AudioUnit, Instruction, gain', runInBrowser, sinOsc, speaker, simpleRun)
import FRP.Behavior.Audio as Aud
import Foreign (Foreign)
import Math (pi, sin)

scene :: Behavior Number -> Behavior (AudioUnit D1)
scene time = f <$> time
  where
  f s =
    let
      rad = pi * s
    in
      speaker
        $ ( (gain' 0.1 $ sinOsc (440.0 + (10.0 * sin (2.3 * rad))))
              :| (gain' 0.25 $ sinOsc (235.0 + (10.0 * sin (1.7 * rad))))
              : (gain' 0.2 $ sinOsc (337.0 + (10.0 * sin rad)))
              : (gain' 0.1 $ sinOsc (530.0 + (19.0 * (5.0 * sin rad))))
              : Nil
          )

-- change to true if you use `microphone` above
enableMicrophone = false

main :: Effect Unit
main = do
  _ <- simpleRun scene
</div>
  <div id="console"># Welcome to klank.dev!
- Press Ctrl-K (Win/Linux) or Command-K (Mac) to play the current audio scene
- Press Ctrl-X (Win/Linux) or Command-X (Mac) to stop playback
- Press Ctrl-C (Win/Linux) or Command-C (Mac) to recompile the scene when you make changes
- Documentaion, feature requests, and issues on [GitHub](https://github.com/mikesol/purescript-audio-behaviors) _ctrl-click on link to open_
- Have fun ðŸ”Š ðŸŽ§
  </div>
    <script
      src="/ace-builds/src-noconflict/ace.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    <script
      src="/ace-builds/src-noconflict/ext-linking.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    <script>
      var editor = ace.edit("editor");
      editor.setOption("showPrintMargin", false);
      editor.setTheme("ace/theme/monokai");
      editor.session.setMode("ace/mode/haskell");
      editor.commands.addCommand({
        name: 'play',
        bindKey: {win: 'Ctrl-K',  mac: 'Command-K'},
        exec: function(editor) {
            alert('play');
        },
        readOnly: true // false if this command should not apply in readOnly mode
      });
      editor.commands.addCommand({
        name: 'stop',
        bindKey: {win: 'Ctrl-X',  mac: 'Command-X'},
        exec: function(editor) {
            alert('stop');
        },
        readOnly: true // false if this command should not apply in readOnly mode
      });
      var console = ace.edit("console");
      console.setReadOnly(true);
      console.setOption("showPrintMargin", false);
      console.setOption("showLineNumbers", false);
      // console.setOption("showGutter", false);
      console.session.setMode("ace/mode/markdown");
      console.setOptions({
        enableLinking: true
      });
      console.on("linkClick", function() {
        window.open("https://github.com/mikesol/purescript-audio-behaviors");
      });
    </script>
  </body>
</html>
